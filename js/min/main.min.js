function sectorLine(t){var e=chart.selectAll(".sector").data(t).enter().append("g").attr("class","sector").attr("class",function(t){return d3.select(this).attr("class")+" "+t.name});e.append("path").attr("class","line").attr("d",function(t){return line(t.values)}).style("stroke","white").transition().style("opacity",1),e.append("text").datum(function(t){return{name:t.name,value:t.values[t.values.length-1]}}).attr("transform",function(t){return"translate("+x(t.value.date)+","+y(t.value.rate)+")"}).attr("x",0).attr("dy",".35em").text(function(t){return t.name})}function rescale(t){y.domain([d3.min(t,function(t){return d3.min(t.values,function(t){return t.rate})}),d3.max(t,function(t){return d3.max(t.values,function(t){return t.rate})})]),d3.select(".y.axis").call(yAxis)}$(document).ready(function(){});var margin={top:20,right:20,bottom:20,left:40},width=600-margin.left-margin.right,dash_styles=["none","5, 5","10, 10",".9,.9","15, 10, 5, 10","15,5,5,5"],margin={top:20,right:30,bottom:30,left:40},width=600-margin.left-margin.right,height=400-margin.top-margin.bottom,parseDate=d3.time.format("%Y%m%d").parse,x=d3.time.scale().range([0,width]),y=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(x).orient("bottom"),yAxis=d3.svg.axis().scale(y).orient("left"),color=d3.scale.category10(),line=d3.svg.line().interpolate("basis").x(function(t){return x(t.date)}).y(function(t){return y(t.rate)}),chart=d3.select(".chart").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("./data/scot_mfg.csv",function(t,e){color.domain(d3.keys(e[0]).filter(function(t){return"date"!==t})),e.forEach(function(t){t.date=parseDate(t.date)});var a=color.domain().map(function(t){return{name:t,values:e.map(function(e){return{date:e.date,rate:+e[t]}})}});a.push({name:"basis",values:e.map(function(t){return{date:t.date,rate:100}})}),console.log(a);var n=a,r=a.slice(0,1),s=a.slice(-1);console.log(s),r=r.push(s),console.log(r);x.domain(d3.extent(e,function(t){return t.date})),y.domain([d3.min(r,function(t){return d3.min(t.values,function(t){return t.rate})}),d3.max(r,function(t){return d3.max(t.values,function(t){return t.rate})})]),chart.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis),chart.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Growth (%)"),sectorLine(r),d3.select(".show-sectors").on("click",function(){this.classList.contains("sectors-on")?(chart.selectAll(".sector").remove(),rescale(r),sectorLine(r),d3.select(this).classed("sectors-on",!1)):(chart.selectAll(".sector").remove(),rescale(n),sectorLine(n),d3.select(this).classed("sectors-on",!0))})});